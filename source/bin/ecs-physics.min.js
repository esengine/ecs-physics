window.physics={},window.__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();var __values=this&&this.__values||function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],i=0;return e?e.call(t):{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}}};!function(t){var e=function(){function t(){}return t.USE_ACTIVE_CONTACT_SET=!1,t}();t.Defined=e}(physics||(physics={})),function(t){!function(t){t[t.none=0]="none",t[t.all=Number.MAX_VALUE]="all",t[t.cat1=1]="cat1",t[t.cat2=2]="cat2",t[t.cat3=4]="cat3",t[t.cat4=8]="cat4",t[t.cat5=16]="cat5",t[t.cat6=32]="cat6",t[t.cat7=64]="cat7",t[t.cat8=128]="cat8",t[t.cat9=256]="cat9",t[t.cat10=512]="cat10",t[t.cat11=1024]="cat11",t[t.cat12=2048]="cat12",t[t.cat13=4096]="cat13",t[t.cat14=8192]="cat14",t[t.cat15=16384]="cat15",t[t.cat16=32768]="cat16",t[t.cat17=65536]="cat17",t[t.cat18=131072]="cat18",t[t.cat19=262144]="cat19",t[t.cat20=524288]="cat20",t[t.cat21=1048576]="cat21",t[t.cat22=2097152]="cat22",t[t.cat23=4194304]="cat23",t[t.cat24=8388608]="cat24",t[t.cat25=16777216]="cat25",t[t.cat26=33554432]="cat26",t[t.cat27=67108864]="cat27",t[t.cat28=134217728]="cat28",t[t.cat29=268435456]="cat29",t[t.cat30=536870912]="cat30",t[t.cat31=1073741824]="cat31"}(t.Category||(t.Category={}));var e=function(){return function(){}}();t.FixtureProxy=e;var i=function(){function i(e,s,o){void 0===o&&(o=null),this.body=e,this.userData=o,this.shape=s.clone(),this.fixtureId=i._fixtureIdCounter++,this._collisonCategories=t.Settings.defaultFixtureCollisionCategories,this._collidesWith=t.Settings.defaultFixtureCollidesWith,this._collisionGroup=0,this._colisionIgnores=new Set,this.ignoreCCDWith=t.Settings.defaultFixtureIgnoreCCDWith,this.friction=.2,this.restitution=0}return Object.defineProperty(i.prototype,"collisionGroup",{get:function(){return this._collisionGroup},set:function(t){this._collisionGroup!=t&&(this._collisionGroup=t,this.refilter())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"collidesWith",{get:function(){return this._collidesWith},set:function(t){this._collidesWith!=t&&(this._collidesWith=t,this.refilter())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"collisionCategories",{get:function(){return this._collisonCategories},set:function(t){this._collisonCategories!=t&&(this._collisonCategories=t,this.refilter())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isSensor",{get:function(){return this._isSensor},set:function(t){null!=this.body&&(this.body.isAwake=!0),this._isSensor=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"friction",{get:function(){return this._friction},set:function(t){console.assert(!Number.isNaN(t)),this._friction=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"restitution",{get:function(){return this._restitution},set:function(t){console.assert(!Number.isNaN(t)),this._restitution=t},enumerable:!0,configurable:!0}),i.prototype.dispose=function(){this.isDisposed},i.prototype.restoreCollisionWith=function(t){this._colisionIgnores.has(t.fixtureId)&&(this._colisionIgnores.delete(t.fixtureId),this.refilter())},i.prototype.ignoreCollisionWith=function(t){this._colisionIgnores.has(t.fixtureId)||(this._colisionIgnores.add(t.fixtureId),this.refilter())},i.prototype.isFixtureIgnored=function(t){return this._colisionIgnores.has(t.fixtureId)},i.prototype.refilter=function(){for(var t=this.body.contactList;null!=t;){var e=t.contact,i=e.fixtureA,s=e.fixtureB;i!=this&&s!=this||(e.filterFlag=!0),t=t.next}var o=this.body._world;if(null!=o)for(var n=o.contactManager.broadPhase,r=0;r<this.proxyCount;++r)n.touchProxy(this.proxies[r].proxyId)},i.prototype.registerFixture=function(){var t=this;if(this.proxies=[],this.proxyCount=0,this.body.enabled){var e=this.body._world.contactManager.broadPhase;this.createProxies(e,this.body._xf)}this.body.fixtureList.push(this),this.shape._density>0&&this.body.resetMassData(),this.body._world._worldHasNewFixture=!0,null!=this.body._world.onFixtureAdded&&this.body._world.onFixtureAdded.forEach(function(e){return e(t)})},i.prototype.rayCast=function(t,e,i){return this.shape.rayCast(t,e,this.body._xf,i)},i.prototype.destroy=function(){var e=this;this.shape.shapeType==t.ShapeType.polygon&&(this.shape.vertices.attackedToBody=!1),console.assert(0==this.proxyCount),this.proxies=null,this.shape=null,this.userData=null,this.beforeCollision=null,this.onCollision=null,this.onSeperation=null,this.afterCollision=null,null!=this.body._world.onFixtureRemoved&&this.body._world.onFixtureRemoved.forEach(function(t){return t(e)}),this.body._world.onFixtureAdded=null,this.body._world.onFixtureRemoved=null,this.onSeperation=null,this.onCollision=null},i.prototype.createProxies=function(t,i){console.assert(0==this.proxyCount),this.proxyCount=this.shape.childCount;for(var s=0;s<this.proxyCount;++s){var o=new e;this.shape.computeAABB(o.aabb,i,s),o.fixture=this,o.childIndex=s,o.proxyId=t.addProxy(o),this.proxies[s]=o}},i.prototype.destroyProxies=function(t){for(var e=0;e<this.proxyCount;++e)t.removeProxy(this.proxies[e].proxyId),this.proxies[e].proxyId=-1;this.proxyCount=0},i.prototype.synchronize=function(e,i,s){if(0!=this.proxyCount)for(var o=0;o<this.proxyCount;++o){var n=this.proxies[o],r=new t.AABB,a=new t.AABB;this.shape.computeAABB(r,i,n.childIndex),this.shape.computeAABB(a,s,n.childIndex),n.aabb.combineT(r,a);var h=s.p.sub(i.p);e.moveProxy(n.proxyId,n.aabb,h)}},i}();t.Fixture=i}(physics||(physics={})),function(t){var e=function(){function e(){}return e.mixFriction=function(t,e){return Math.sqrt(t*e)},e.mixRestitution=function(t,e){return t>e?t:e},e.maxFloat=3.402823466e38,e.epsilon=1.192092896e-7,e.pi=3.14159265359,e.enableDiagnostics=!0,e.defaultFixtureCollisionCategories=t.Category.cat1,e.defaultFixtureCollidesWith=t.Category.all,e.defaultFixtureIgnoreCCDWith=t.Category.none,e.aabbExtension=.1,e.linearSlop=.005,e.polygonRadius=2*e.linearSlop,e.maxPolygonVertices=8,e.useConvexHullPolygons=!0,e.maxGJKIterations=20,e}();t.Settings=e}(physics||(physics={})),function(t){var e=function(){return function(){}}();t.RayCastInput=e;var i=function(){return function(){}}();t.RayCastOutput=i,function(t){t[t.circles=0]="circles",t[t.faceA=1]="faceA",t[t.faceB=2]="faceB"}(t.ManifoldType||(t.ManifoldType={}));var s=function(){return function(){}}();t.Manifold=s;var o=function(){return function(){}}();t.ManifoldPoint=o;var n=function(){return function(){}}();t.ContactID=n;var r=function(){return function(){}}();t.ContactFeature=r;var a=function(){function e(t,e){void 0===t&&(t=new es.Vector2),void 0===e&&(e=new es.Vector2),this.lowerBound=t,this.upperBound=e}return Object.defineProperty(e.prototype,"width",{get:function(){return this.upperBound.x-this.lowerBound.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.upperBound.y-this.lowerBound.y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"center",{get:function(){return this.lowerBound.add(this.upperBound).scale(.5)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"extents",{get:function(){return this.upperBound.sub(this.lowerBound).scale(.5)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"perimeter",{get:function(){return 2*(this.upperBound.x-this.lowerBound.x+(this.upperBound.y-this.lowerBound.y))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vertices",{get:function(){var e=new t.Vertices;return e.push(this.upperBound),e.push(new es.Vector2(this.upperBound.x,this.lowerBound.y)),e.push(this.lowerBound),e.push(new es.Vector2(this.lowerBound.x,this.upperBound.y)),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"q1",{get:function(){return new e(this.center,this.upperBound)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"q2",{get:function(){return new e(new es.Vector2(this.lowerBound.x,this.center.y),new es.Vector2(this.center.x,this.upperBound.y))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"q3",{get:function(){return new e(this.lowerBound,this.center)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"q4",{get:function(){return new e(new es.Vector2(this.center.x,this.lowerBound.y),new es.Vector2(this.upperBound.x,this.center.y))},enumerable:!0,configurable:!0}),e.prototype.isValid=function(){var t=this.upperBound.sub(this.lowerBound),e=t.x>=0&&t.y>=0;return e=e&&this.lowerBound.isValid()&&this.upperBound.isValid()},e.prototype.combine=function(t){this.lowerBound=es.Vector2.min(this.lowerBound,t.lowerBound),this.upperBound=es.Vector2.max(this.upperBound,t.upperBound)},e.prototype.combineT=function(t,e){this.lowerBound=es.Vector2.min(t.lowerBound,e.lowerBound),this.upperBound=es.Vector2.max(t.upperBound,e.upperBound)},e.prototype.contains=function(t){var e=!0;return e=(e=(e=(e=e&&this.lowerBound.x<=t.lowerBound.x)&&this.lowerBound.y<=t.lowerBound.y)&&t.upperBound.x<=this.upperBound.x)&&t.upperBound.y<=this.upperBound.y},e.testOverlap=function(t,e){var i=e.lowerBound.sub(t.upperBound),s=t.lowerBound.sub(e.upperBound);return!(i.x>0||i.y>0)&&!(s.x>0||s.y>0)},e}();t.AABB=a;var h=function(){function e(){}return e.testOverlap=function(e,i,s,o,n,r){this._input=this._input?this._input:new t.DistanceInput,this._input.proxyA.set(e,i),this._input.proxyB.set(s,o),this._input.transformA=n,this._input.transformB=r,this._input.useRadii=!0;new t.SimplexCache;var a=new t.DistanceOutput;return t.Distance.computeDistance(a,this._input),a.distance<10*t.Settings.epsilon},e}();t.Collision=h}(physics||(physics={})),function(t){var e=function(){function e(){this.vertices=new t.Vertices}return e.prototype.set=function(e,i){switch(e.shapeType){case t.ShapeType.circle:var s=e;this.vertices.length=0,this.vertices.push(s.position),this.radius=s.radius;break;case t.ShapeType.polygon:var o=e;this.vertices.length=0;for(var n=0;n<o.vertices.length;n++)this.vertices.push(o.vertices[n]);this.radius=o.radius;break;case t.ShapeType.chain:var r=e;console.assert(0<=i&&i<r.vertices.length),this.vertices.length=0,this.vertices.push(r.vertices[i]),this.vertices.push(i+1<r.vertices.length?r.vertices[i+1]:r.vertices[0]),this.radius=r.radius;break;case t.ShapeType.edge:var a=e;this.vertices.length=0,this.vertices.push(a.vertex1),this.vertices.push(a.vertex2),this.radius=a.radius;break;default:console.assert(!1)}},e.prototype.getSupport=function(t){for(var e=0,i=this.vertices[0].dot(t),s=1;s<this.vertices.length;++s){var o=this.vertices[s].dot(t);o>i&&(e=s,i=o)}return e},e}();t.DistanceProxy=e;var i=function(){function e(){this.count=0}return e.prototype.readCache=function(e,i,s,o,n){console.assert(e.count<=3),this.count=e.count;for(var r=0;r<this.count;++r){(l=this.v.get(r)).indexA=e.indexA[r],l.indexB=e.indexB[r];var a=i.vertices[l.indexA],h=o.vertices[l.indexB];l.wA=t.MathUtils.mul(s,a),l.wB=t.MathUtils.mul(n,h),l.w=l.wB.sub(l.wA),l.a=0,this.v[r]=l}if(this.count>1){var c=e.metric,u=this.getMetric();(u<.5*c||2*c<u||u<t.Settings.epsilon)&&(this.count=0)}if(0==this.count){var l;(l=this.v.get(0)).indexA=0,l.indexB=0;a=i.vertices[0],h=o.vertices[0];l.wA=t.MathUtils.mul(s,a),l.wB=t.MathUtils.mul(n,h),l.w=l.wB.sub(l.wA),l.a=1,this.v.set(0,l),this.count=1}},e.prototype.writeCache=function(t){t.metric=this.getMetric(),t.count=this.count;for(var e=0;e<this.count;++e)t.indexA.set(e,this.v.get(e).indexA),t.indexB.set(e,this.v.get(e).indexB)},e.prototype.getMetric=function(){switch(this.count){case 0:return console.assert(!1),0;case 1:return 0;case 2:return this.v.get(0).w.sub(this.v.get(1).w).magnitude();case 3:return t.MathUtils.cross(this.v.get(1).w.sub(this.v.get(0).w),this.v.get(2).w.sub(this.v.get(0).w));default:return console.assert(!1),0}},e.prototype.solve2=function(){var t=this.v.get(0).w,e=this.v.get(1).w,i=e.sub(t),s=-t.dot(i);if(s<=0){var o=this.v.get(0);return o.a=1,this.v.set(0,o),void(this.count=1)}var n=e.dot(i);if(n<=0){var r=this.v.get(1);return r.a=1,this.v.set(1,r),this.count=1,void this.v.set(0,this.v.get(1))}var a=1/(n+s),h=this.v.get(0),c=this.v.get(1);h.a=n*a,c.a=s*a,this.v.set(0,h),this.v.set(1,c),this.count=2},e.prototype.solve3=function(){var e=this.v.get(0).w,i=this.v.get(1).w,s=this.v.get(2).w,o=i.sub(e),n=e.dot(o),r=i.dot(o),a=-n,h=s.sub(e),c=e.dot(h),u=s.dot(h),l=-c,p=s.sub(i),d=i.dot(p),f=s.dot(p),y=-d,v=t.MathUtils.cross(o,h),_=v*t.MathUtils.cross(i,s),g=v*t.MathUtils.cross(s,e),x=v*t.MathUtils.cross(e,i);if(a<=0&&l<=0){var b=this.v.get(0);return b.a=1,this.v.set(0,b),void(this.count=1)}if(r>0&&a>0&&x<=0){var m=1/(r+a),w=this.v.get(0),C=this.v.get(1);return w.a=r*m,C.a=a*m,this.v.set(0,w),this.v.set(1,C),void(this.count=2)}if(u>0&&l>0&&g<=0){var B=1/(u+l),A=this.v.get(0),S=this.v.get(2);return A.a=u*B,S.a=l*B,this.v.set(0,A),this.v.set(2,S),this.count=2,void this.v.set(1,this.v.get(2))}if(r<=0&&y<=0){var V=this.v.get(1);return V.a=1,this.v.set(1,V),this.count=1,void this.v.set(0,this.v.get(1))}if(u<=0&&f<=0){var P=this.v.get(2);return P.a=1,this.v.set(2,P),this.count=1,void this.v.set(0,this.v.get(2))}if(f>0&&y>0&&_<=0){var T=1/(f+y),O=this.v.get(1),N=this.v.get(2);return O.a=f*T,N.a=y*T,this.v.set(1,O),this.v.set(2,N),this.count=2,void this.v.set(0,this.v.get(2))}var L=1/(_+g+x),M=this.v.get(0),k=this.v.get(1),I=this.v.get(2);M.a=_*L,k.a=g*L,I.a=x*L,this.v.set(0,M),this.v.set(1,k),this.v.set(2,I),this.count=3},e.prototype.getSearchDirection=function(){switch(this.count){case 1:return this.v.get(0).w.scale(-1);case 2:var e=this.v.get(1).w.sub(this.v.get(0).w);return t.MathUtils.cross(e,this.v.get(0).w.scale(-1))>0?new es.Vector2(-e.y,e.x):new es.Vector2(e.y,-e.x);default:return console.assert(!1),es.Vector2.zero}},e.prototype.getWitnessPoints=function(t,e){switch(this.count){case 0:es.Vector2.zero,es.Vector2.zero,console.assert(!1);break;case 1:this.v.get(0).wA,this.v.get(0).wB;break;case 2:this.v.get(0).wA.scale(this.v.get(0).a).add(this.v.get(1).wA.scale(this.v.get(1).a)),this.v.get(0).wB.scale(this.v.get(0).a).add(this.v.get(1).wB.scale(this.v.get(1).a));break;case 3:this.v.get(0).wA.scale(this.v.get(0).a).add(this.v.get(1).wA.scale(this.v.get(1).a)).add(this.v.get(2).wA.scale(this.v.get(2).a));break;default:throw new Error("exception")}},e}(),s=function(){function e(){}return e.computeDistance=function(e,s){var o=new r;t.Settings.enableDiagnostics&&++this.gjkCalls;var n=new i;n.readCache(o,s.proxyA,s.transformA,s.proxyB,s.transformB);for(var a=new t.FixedArray3,h=new t.FixedArray3,c=0;c<t.Settings.maxGJKIterations;){for(var u=n.count,l=0;l<u;++l)a.set(l,n.v.get(l).indexA),h.set(l,n.v.get(l).indexB);switch(n.count){case 1:break;case 2:n.solve2();break;case 3:n.solve3();break;default:console.assert(!1)}if(3==n.count)break;var p=n.getSearchDirection();if(p.lengthSquared()<t.Settings.epsilon*t.Settings.epsilon)break;var d=n.v.get(n.count);d.indexA=s.proxyA.getSupport(t.MathUtils.mulT(s.transformA.q,p.scale(-1))),d.wA=t.MathUtils.mul(s.transformA,s.proxyA.vertices[d.indexA]),d.indexB=s.proxyB.getSupport(t.MathUtils.mulT(s.transformB.q,p)),d.wB=t.MathUtils.mul(s.transformB,s.proxyB.vertices[d.indexB]),d.w=d.wB.sub(d.wA),n.v.set(n.count,d),++c,t.Settings.enableDiagnostics&&++this.gjkIters;var f=!1;for(l=0;l<u;++l)if(d.indexA==a.get(l)&&d.indexB==h.get(l)){f=!0;break}if(f)break;++n.count}if(t.Settings.enableDiagnostics&&(this.gjkMaxIters=Math.max(this.gjkMaxIters,c)),n.getWitnessPoints(e.pointA,e.pointB),e.distance=e.pointA.sub(e.pointB).magnitude(),e.iterations=c,n.writeCache(o),s.useRadii){var y=s.proxyA.radius,v=s.proxyB.radius;if(e.distance>y+v&&e.distance>t.Settings.epsilon){e.distance-=y+v;var _=e.pointB.sub(e.pointA).normalize();e.pointA=e.pointA.add(_.scale(y)),e.pointB=e.pointB.sub(_.scale(v))}else{var g=e.pointA.add(e.pointB).scale(.5);e.pointA=g,e.pointB=g,e.distance=0}}return o},e}();t.Distance=s;var o=function(){return function(){this.proxyA=new e,this.proxyB=new e}}();t.DistanceInput=o;var n=function(){return function(){}}();t.DistanceOutput=n;var r=function(){return function(){}}();t.SimplexCache=r}(physics||(physics={})),function(t){var e=function(){function t(){}return t.prototype.isLeaf=function(){return this.child1==i.nullNode},t}();t.TreeNode=e;var i=function(){function i(){this._raycastStack=[],this._queryStack=[],this._root=i.nullNode,this._nodeCapacity=16,this._nodeCount=0,this._nodes=[];for(var t=0;t<this._nodeCapacity-1;++t)this._nodes[t]=new e,this._nodes[t].parentOrNext=t+1,this._nodes[t].height=1;this._nodes[this._nodeCapacity-1]=new e,this._nodes[this._nodeCapacity-1].parentOrNext=i.nullNode,this._nodes[this._nodeCapacity-1].height=1,this._freeList=0}return Object.defineProperty(i.prototype,"height",{get:function(){return this._root==i.nullNode?0:this._nodes[this._root].height},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"areaRatio",{get:function(){if(this._root==i.nullNode)return 0;for(var t=this._nodes[this._root].aabb.perimeter,e=0,s=0;s<this._nodeCapacity;++s){var o=this._nodes[s];o.height<0||(e+=o.aabb.perimeter)}return e/t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"maxBalance",{get:function(){for(var t=0,e=0;e<this._nodeCapacity;++e){var i=this._nodes[e];if(!(i.height<=1)){console.assert(0==i.isLeaf());var s=i.child1,o=i.child2,n=Math.abs(this._nodes[o].height-this._nodes[s].height);t=Math.max(t,n)}}return t},enumerable:!0,configurable:!0}),i.prototype.addProxy=function(e,i){var s=this.allocateNode(),o=new es.Vector2(t.Settings.aabbExtension,t.Settings.aabbExtension);return this._nodes[s].aabb.lowerBound=e.lowerBound.sub(o),this._nodes[s].aabb.upperBound=e.upperBound.add(o),this._nodes[s].userData=i,this._nodes[s].height=0,this.insertLeaf(s),s},i.prototype.removeProxy=function(t){console.assert(0<=t&&t<this._nodeCapacity),console.assert(this._nodes[t].isLeaf()),this.removeLeaf(t),this.freeNode(t)},i.prototype.moveProxy=function(e,i,s){if(console.assert(0<=e&&e<this._nodeCapacity),console.assert(this._nodes[e].isLeaf()),this._nodes[e].aabb.contains(i))return!1;this.removeLeaf(e);var o=i,n=new es.Vector2(t.Settings.aabbExtension,t.Settings.aabbExtension);o.lowerBound=o.lowerBound.sub(n),o.upperBound=o.upperBound.add(n);var r=s.scale(t.Settings.aabbExtension);return r.x<0?o.lowerBound.x+=r.x:o.upperBound.x+=r.x,r.y<0?o.lowerBound.y+=r.y:o.upperBound.y+=r.y,this._nodes[e].aabb=o,this.insertLeaf(e),!0},i.prototype.getUserData=function(t){return console.assert(0<=t&&t<this._nodeCapacity),this._nodes[t].userData},i.prototype.getFatAABB=function(t){return console.assert(0<=t&&t<this._nodeCapacity),this._nodes[t].aabb},i.prototype.allocateNode=function(){if(this._freeList==i.nullNode){console.assert(this._nodeCount==this._nodeCapacity);var s=this._nodes;this._nodeCapacity*=2,this._nodes=s.slice(0,this._nodeCount);for(var o=this._nodeCount;o<this._nodeCapacity-1;++o)this._nodes[o]=new e,this._nodes[o].parentOrNext=o+1,this._nodes[o].height=-1;this._nodes[this._nodeCapacity-1]=new e,this._nodes[this._nodeCapacity-1].parentOrNext=i.nullNode,this._nodes[this._nodeCapacity-1].height=-1,this._freeList=this._nodeCount}var n=this._freeList;return this._freeList=this._nodes[n].parentOrNext,this._nodes[n].parentOrNext=i.nullNode,this._nodes[n].child1=i.nullNode,this._nodes[n].child2=i.nullNode,this._nodes[n].height=0,this._nodes[n].userData=new t.FixtureProxy,++this._nodeCount,n},i.prototype.freeNode=function(t){console.assert(0<=t&&t<this._nodeCapacity),console.assert(0<this._nodeCount),this._nodes[t].parentOrNext=this._freeList,this._nodes[t].height=-1,this._freeList=t,--this._nodeCount},i.prototype.insertLeaf=function(e){if(this._root==i.nullNode)return this._root=e,void(this._nodes[this._root].parentOrNext=i.nullNode);for(var s=this._nodes[e].aabb,o=this._root;0==this._nodes[o].isLeaf();){var n=this._nodes[o].child1,r=this._nodes[o].child2,a=this._nodes[o].aabb.perimeter,h=new t.AABB;h.combineT(this._nodes[o].aabb,s);var c=h.perimeter,u=2*c,l=2*(c-a),p=0;if(this._nodes[n].isLeaf()){(y=new t.AABB).combineT(s,this._nodes[n].aabb),p=y.perimeter+l}else{(y=new t.AABB).combineT(s,this._nodes[n].aabb);var d=this._nodes[n].aabb.perimeter;p=y.perimeter-d+l}var f=0;if(this._nodes[r].isLeaf()){(y=new t.AABB).combineT(s,this._nodes[r].aabb),f=y.perimeter+l}else{var y;(y=new t.AABB).combineT(s,this._nodes[r].aabb);d=this._nodes[r].aabb.perimeter;f=y.perimeter-d+l}if(u<p&&p<f)break;o=p<f?n:r}var v=o,_=this._nodes[v].parentOrNext,g=this.allocateNode();for(this._nodes[g].parentOrNext=_,this._nodes[g].userData=new t.FixtureProxy,this._nodes[g].aabb.combineT(s,this._nodes[v].aabb),this._nodes[g].height=this._nodes[v].height+1,_!=i.nullNode?(this._nodes[_].child1==v?this._nodes[_].child1=g:this._nodes[_].child2=g,this._nodes[g].child1=v,this._nodes[g].child2=e,this._nodes[v].parentOrNext=g,this._nodes[e].parentOrNext=g):(this._nodes[g].child1=v,this._nodes[g].child2=e,this._nodes[v].parentOrNext=g,this._nodes[e].parentOrNext=g,this._root=g),o=this._nodes[e].parentOrNext;o!=i.nullNode;){o=this.balance(o);n=this._nodes[o].child1,r=this._nodes[o].child2;console.assert(n!=i.nullNode),console.assert(r!=i.nullNode),this._nodes[o].height=1+Math.max(this._nodes[n].height,this._nodes[r].height),this._nodes[o].aabb.combineT(this._nodes[n].aabb,this._nodes[r].aabb),o=this._nodes[o].parentOrNext}},i.prototype.removeLeaf=function(t){if(t!=this._root){var e=this._nodes[t].parentOrNext,s=this._nodes[e].parentOrNext,o=0;if(o=this._nodes[e].child1==t?this._nodes[e].child2:this._nodes[e].child1,s!=i.nullNode){this._nodes[s].child1==e?this._nodes[s].child1=o:this._nodes[s].child2=o,this._nodes[o].parentOrNext=s,this.freeNode(e);for(var n=s;n!=i.nullNode;){n=this.balance(n);var r=this._nodes[n].child1,a=this._nodes[n].child2;this._nodes[n].aabb.combineT(this._nodes[r].aabb,this._nodes[a].aabb),this._nodes[n].height=1+Math.max(this._nodes[r].height,this._nodes[a].height),n=this._nodes[n].parentOrNext}}else this._root=o,this._nodes[o].parentOrNext=i.nullNode,this.freeNode(e)}else this._root=i.nullNode},i.prototype.balance=function(t){console.assert(t!=i.nullNode);var e=this._nodes[t];if(e.isLeaf()||e.height<2)return t;var s=e.child1,o=e.child2;console.assert(0<=s&&s<this._nodeCapacity),console.assert(0<=o&&o<this._nodeCapacity);var n=this._nodes[s],r=this._nodes[o];if(r.height-n.height>1){var a=r.child1,h=r.child2,c=this._nodes[a],u=this._nodes[h];return console.assert(0<=a&&a<this._nodeCapacity),console.assert(0<=h&&h<this._nodeCapacity),r.child1=t,r.parentOrNext=e.parentOrNext,e.parentOrNext=o,r.parentOrNext!=i.nullNode?this._nodes[r.parentOrNext].child1==t?this._nodes[r.parentOrNext].child1=o:(console.assert(this._nodes[r.parentOrNext].child2==t),this._nodes[r.parentOrNext].child2=o):this._root=o,c.height>u.height?(r.child2=a,e.child2=h,u.parentOrNext=t,e.aabb.combineT(n.aabb,u.aabb),r.aabb.combineT(e.aabb,c.aabb),e.height=1+Math.max(n.height,u.height),r.height=1+Math.max(e.height,c.height)):(r.child2=h,e.child2=a,c.parentOrNext=t,e.aabb.combineT(n.aabb,c.aabb),r.aabb.combineT(e.aabb,u.aabb),e.height=1+Math.max(n.height,c.height),r.height=1+Math.max(e.height,u.height)),o}},i.nullNode=-1,i}();t.DynamicTree=i}(physics||(physics={})),function(t){!function(){function t(){this.proxyIdA=0,this.proxyIdB=0}t.prototype.compareTo=function(t){if(this.proxyIdA<t.proxyIdA)return-1;if(this.proxyIdA==t.proxyIdA){if(this.proxyIdB<t.proxyIdB)return-1;if(this.proxyIdB==t.proxyIdB)return 0}return 1}}();var e=function(){function e(){this._moveCapacity=0,this._moveCount=0,this._pairCapacity=0,this._pairCount=0,this._proxyCount=0,this._queryProxyId=0,this._tree=new t.DynamicTree,this._queryCallback=this.queryCallback,this._proxyCount=0,this._pairCapacity=16,this._pairCount=0,this._pairBuffer=[],this._moveCapacity=16,this._moveCount=0,this._moveBuffer=[]}return Object.defineProperty(e.prototype,"proxyCount",{get:function(){return this._proxyCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"treeQuality",{get:function(){return this._tree.areaRatio},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"treeBalance",{get:function(){return this._tree.maxBalance},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"treeHeight",{get:function(){return this._tree.height},enumerable:!0,configurable:!0}),e.prototype.addProxy=function(t){var e=this._tree.addProxy(t.aabb,t);return++this._proxyCount,this.bufferMove(e),e},e.prototype.removeProxy=function(t){this.unBufferMove(t),--this._proxyCount,this._tree.removeProxy(t)},e.prototype.touchProxy=function(t){this.bufferMove(t)},e.prototype.moveProxy=function(t,e,i){this._tree.moveProxy(t,e,i)&&this.bufferMove(t)},e.prototype.bufferMove=function(t){if(this._moveCount==this._moveCapacity){var e=this._moveBuffer;this._moveCapacity*=2,this._moveBuffer=e.slice(0,this._moveCount)}this._moveBuffer[this._moveCount]=t,++this._moveCount},e.prototype.unBufferMove=function(e){for(var i=0;i<this._moveCount;++i)this._moveBuffer[i]==e&&(this._moveBuffer[i]=t.DynamicTree.nullNode)},e.prototype.queryCallback=function(t){if(t==this._queryProxyId)return!0;if(this._pairCount==this._pairCapacity){var e=this._pairBuffer;this._pairCapacity*=2,this._pairBuffer=e.slice(0,this._pairCount)}return this._pairBuffer[this._pairCount].proxyIdA=Math.min(t,this._queryProxyId),this._pairBuffer[this._pairCount].proxyIdB=Math.max(t,this._queryProxyId),++this._pairCount,!0},e.prototype.getProxy=function(t){return this._tree.getUserData(t)},e.prototype.testOverlap=function(e,i){var s=this._tree.getFatAABB(e),o=this._tree.getFatAABB(i);return t.AABB.testOverlap(s,o)},e.nullProxy=-1,e}();t.DynamicTreeBroadPhase=e}(physics||(physics={})),function(t){var e=function(){return function(){this.proxyA=new t.DistanceProxy,this.proxyB=new t.DistanceProxy}}();t.TOIInput=e,function(t){t[t.unknown=0]="unknown",t[t.failed=1]="failed",t[t.overlapped=2]="overlapped",t[t.touching=3]="touching",t[t.seperated=4]="seperated"}(t.TOIOutputState||(t.TOIOutputState={}))}(physics||(physics={})),function(t){var e,i=function(){function t(){}return t.equals=function(t,e){return t.area==e.area&&t.mass==e.mass&&t.centroid==e.centroid&&t.inertia==e.inertia},t.notEquals=function(e,i){return!t.equals(e,i)},t.prototype.equals=function(e){return t.equals(this,e)},t}();t.MassData=i,function(t){t[t.unknown=-1]="unknown",t[t.circle=0]="circle",t[t.edge=1]="edge",t[t.polygon=2]="polygon",t[t.chain=3]="chain",t[t.typeCount=4]="typeCount"}(e=t.ShapeType||(t.ShapeType={}));var s=function(){function t(t){this._density=t,this.shapeType=e.unknown}return Object.defineProperty(t.prototype,"density",{get:function(){return this._density},set:function(t){console.assert(t>=0),this._density=t,this.computeProperties()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"radius",{get:function(){return this._radius},set:function(t){console.assert(t>=0),this._radius=t,this._2radius=this._radius*this._radius,this.computeProperties()},enumerable:!0,configurable:!0}),t.prototype.compareTo=function(t){return!1},t}();t.Shape=s}(physics||(physics={})),function(t){var e=function(e){function i(i,s){var o=e.call(this,0)||this;return o.shapeType=t.ShapeType.edge,o._radius=t.Settings.polygonRadius,i&&s&&o.set(i,s),o}return __extends(i,e),Object.defineProperty(i.prototype,"childCount",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"vertex1",{get:function(){return this._vertex1},set:function(t){this._vertex1=t,this.computeProperties()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"vertex2",{get:function(){return this._vertex2},set:function(t){this._vertex2=t,this.computeProperties()},enumerable:!0,configurable:!0}),i.prototype.set=function(t,e){this._vertex1=t,this._vertex2=e,this.hasVertex0=!1,this.hasVertex3=!1,this.computeProperties()},i.prototype.testPoint=function(t,e){return!1},i.prototype.rayCast=function(e,i,s,o){var n=t.MathUtils.mul(s.q,i.point1.sub(s.p)),r=t.MathUtils.mul(s.q,i.point2.sub(s.p)).sub(n),a=this._vertex1.clone(),h=this._vertex2.clone(),c=h.sub(a),u=new es.Vector2(c.y,-c.x);es.Vector2Ext.normalize(u);var l=u.dot(a.sub(n)),p=u.dot(r);if(0==p)return!1;var d=l/p;if(d<0||i.maxFraction<d)return!1;var f=es.Vector2.add(n,r.scale(d)),y=h.sub(a),v=y.dot(y);if(0==v)return!1;var _=f.sub(a).dot(y)/v;return!(_<0||1<_)&&(e.fraction=d,e.normal=l>0?new es.Vector2(-u.x,-u.y):u.clone(),!0)},i.prototype.computeAABB=function(e,i,s){var o=t.MathUtils.mul(i,this._vertex1),n=t.MathUtils.mul(i,this._vertex2),r=es.Vector2.min(o,n),a=es.Vector2.max(o,n),h=new es.Vector2(this.radius,this.radius);e.lowerBound=r.sub(h),e.upperBound=es.Vector2.add(a,h)},i.prototype.computeProperties=function(){this.massData.centroid=es.Vector2.add(this.vertex1,this.vertex2).multiplyScaler(.5)},i.prototype.computeSubmergedArea=function(t,e,i,s){return s.x=0,s.y=0,0},i.prototype.clone=function(){var t=new i;return t.shapeType=this.shapeType,t._radius=this._radius,t._density=this._density,t.hasVertex0=this.hasVertex0,t.hasVertex3=this.hasVertex3,t.vertex0=this.vertex0,t._vertex1=this._vertex1,t._vertex2=this._vertex2,t.vertex2=this.vertex3,t.massData=this.massData,t},i}(t.Shape);t.EdgeShape=e}(physics||(physics={})),function(t){var e=function(e){function i(i,s){void 0===s&&(s=!1);var o=e.call(this,0)||this;return o.shapeType=t.ShapeType.chain,o._radius=t.Settings.polygonRadius,i&&o.setVertices(i,s),o}return __extends(i,e),Object.defineProperty(i.prototype,"childCount",{get:function(){return this.vertices.length-1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"prevVertex",{get:function(){return this._prevVertex},set:function(t){this._prevVertex=t,this._hasPrevVertex=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"nextVertex",{get:function(){return this._nextVertex},set:function(t){this._nextVertex=t,this._hasNextVertex=!0},enumerable:!0,configurable:!0}),i.prototype.getChildEdge=function(e,i){console.assert(0<=i&&i<this.vertices.length-1),console.assert(null!=e),e.shapeType=t.ShapeType.edge,e._radius=this._radius,e.vertex1=this.vertices[i+0],e.vertex2=this.vertices[i+1],i>0?(e.vertex0=this.vertices[i-1],e.hasVertex0=!0):(e.vertex0=this._prevVertex,e.hasVertex0=this._hasPrevVertex),i<this.vertices.length-2?(e.vertex3=this.vertices[i+2],e.hasVertex3=!0):(e.vertex3=this._nextVertex,e.hasVertex3=this._hasNextVertex)},i.prototype.setVertices=function(e,i){void 0===i&&(i=!1),console.assert(null!=e&&e.length>=3),console.assert(e[0]!=e[e.length-1]);for(var s=1;s<e.length;++s){var o=e[s-1],n=e[s];console.assert(o.distance(n)>t.Settings.linearSlop*t.Settings.linearSlop)}this.vertices=e,i&&(this.vertices.push(e[0]),this.prevVertex=this.vertices[this.vertices.length-2],this.nextVertex=this.vertices[1])},i.prototype.testPoint=function(t,e){return!1},i.prototype.rayCast=function(t,e,s,o){console.assert(o<this.vertices.length);var n=o,r=o+1;return r==this.vertices.length&&(r=0),i._edgeShape.vertex1=this.vertices[n],i._edgeShape.vertex2=this.vertices[r],i._edgeShape.rayCast(t,e,s,0)},i.prototype.computeAABB=function(e,i,s){console.assert(s<this.vertices.length);var o=s,n=s+1;n==this.vertices.length&&(n=0);var r=t.MathUtils.mul(i,this.vertices[o]),a=t.MathUtils.mul(i,this.vertices[n]);e.lowerBound=es.Vector2.min(r,a),e.upperBound=es.Vector2.max(r,a)},i.prototype.computeProperties=function(){},i.prototype.computeSubmergedArea=function(t,e,i,s){return s.x=0,s.y=0,0},i.prototype.clone=function(){var e=new i;return e.shapeType=this.shapeType,e._density=this._density,e._radius=this._radius,e.prevVertex=this._prevVertex,e.nextVertex=this._nextVertex,e._hasNextVertex=this._hasNextVertex,e._hasPrevVertex=this._hasPrevVertex,e.vertices=new t.Vertices(this.vertices),e.massData=this.massData,e},i._edgeShape=new t.EdgeShape,i}(t.Shape);t.ChainShape=e}(physics||(physics={})),function(t){var e=function(e){function i(i,s){void 0===i&&(i=0),void 0===s&&(s=0);var o=e.call(this,s)||this;return console.assert(i>=0),console.assert(s>=0),o.shapeType=t.ShapeType.circle,o._position=es.Vector2.zero,o.radius=i,o}return __extends(i,e),Object.defineProperty(i.prototype,"childCount",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"position",{get:function(){return this._position},set:function(t){this._position=t,this.computeProperties()},enumerable:!0,configurable:!0}),i.prototype.testPoint=function(e,i){var s=es.Vector2.add(e.p,t.MathUtils.mul(e.q,this.position)),o=i.sub(s);return o.dot(o)<=this._2radius},i.prototype.rayCast=function(e,i,s,o){var n=es.Vector2.add(s.p,t.MathUtils.mul(s.q,this.position)),r=i.point1.sub(n),a=r.dot(r)-this._2radius,h=i.point2.sub(i.point1),c=r.dot(h),u=h.dot(h),l=c*c-u*a;if(l<0||u<t.Settings.epsilon)return!1;var p=-(c+Math.sqrt(l));return 0<=p&&p<=i.maxFraction*u&&(p/=u,e.fraction=p,e.normal=es.Vector2.add(r,h.scale(p)),es.Vector2Ext.normalize(e.normal),!0)},i.prototype.computeAABB=function(e,i,s){var o=es.Vector2.add(i.p,t.MathUtils.mul(i.q,this.position));e.lowerBound=new es.Vector2(o.x-this.radius,o.y-this.radius),e.upperBound=new es.Vector2(o.x+this.radius,o.y+this.radius)},i.prototype.computeProperties=function(){var e=t.Settings.pi*this._2radius;this.massData.area=e,this.massData.mass=this.density*e,this.massData.centroid=this.position.clone(),this.massData.inertia=this.massData.mass*(.5*this._2radius+this.position.dot(this.position))},i.prototype.computeSubmergedArea=function(e,i,s,o){o.x=0,o.y=0;var n=t.MathUtils.mul(s,this.position),r=-(e.dot(n)-i);if(r<-this.radius+t.Settings.epsilon)return 0;if(r>this.radius)return o=n,t.Settings.pi*this._2radius;var a=r*r,h=this._2radius*(Math.asin(r/this.radius)+t.Settings.pi/2)+r*Math.sqrt(this._2radius-a),c=-2/3*Math.pow(this._2radius-a,1.5)/h;return o.x=n.x+e.x*c,o.y=n.y+e.y*c,h},i.prototype.compareTo=function(t){return this.radius==t.radius&&this.position.equals(t.position)},i.prototype.clone=function(){var t=new i;return t.shapeType=this.shapeType,t._radius=this.radius,t._2radius=this._2radius,t._density=this._density,t._position=this._position,t.massData=this.massData,t},i}(t.Shape);t.CircleShape=e}(physics||(physics={})),function(t){var e=function(e){function i(i,s){void 0===s&&(s=0);var o=e.call(this,s)||this;return o.shapeType=t.ShapeType.polygon,o._radius=t.Settings.polygonRadius,o._vertices=i||new t.Vertices,o._normals=new t.Vertices,o}return __extends(i,e),Object.defineProperty(i.prototype,"vertices",{get:function(){return this._vertices},set:function(e){this.setVerticesNoCopy(new t.Vertices(e))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"normals",{get:function(){return this._normals},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"childCount",{get:function(){return 1},enumerable:!0,configurable:!0}),i.prototype.setVerticesNoCopy=function(e){console.assert(e.length>=3&&e.length<=t.Settings.maxPolygonVertices),this._vertices=e,t.Settings.useConvexHullPolygons&&(this._vertices.length<=3?this._vertices.forceCounterClockWise():this._vertices=t.GiftWrap.getConvexHull(this._vertices)),null==this._normals?this._normals=new t.Vertices:this._normals.length=0;for(var i=0;i<this._vertices.length;++i){var s=i+1<this._vertices.length?i+1:0,o=this._vertices[s].sub(this._vertices[i]);console.assert(o.lengthSquared()>t.Settings.epsilon*t.Settings.epsilon);var n=new es.Vector2(o.y,-o.x);es.Vector2Ext.normalize(n),this._normals.push(n)}this.computeProperties()},i.prototype.computeProperties=function(){if(console.assert(this.vertices.length>=3),!(this._density<=0)){for(var e=es.Vector2.zero,i=0,s=0,o=es.Vector2.zero,n=0;n<this.vertices.length;++n)o.add(this.vertices[n]);o.multiplyScaler(1/this.vertices.length);for(n=0;n<this.vertices.length;++n){var r=this.vertices[n].sub(o),a=n+1<this.vertices.length?this.vertices[n+1].sub(o):this.vertices[0].sub(o),h=t.MathUtils.cross(r,a),c=.5*h;i+=c,e.add(es.Vector2.add(r,a).multiplyScaler(c*(1/3)));var u=r.x,l=r.y,p=a.x,d=a.y;s+=1/3*.25*h*(u*u+p*u+p*p+(l*l+d*l+d*d))}console.assert(i>t.Settings.epsilon),this.massData.area=i,this.massData.mass=this._density*i,e.multiplyScaler(1/i),this.massData.centroid=es.Vector2.add(e,o),this.massData.inertia=this._density*s,this.massData.inertia+=this.massData.mass*(this.massData.centroid.dot(this.massData.centroid)-e.dot(e))}},i.prototype.testPoint=function(e,i){for(var s=t.MathUtils.mul(e.q,i.sub(e.p)),o=0;o<this.vertices.length;++o){if(this.normals[o].dot(s.sub(this.vertices[o]))>0)return!1}return!0},i.prototype.rayCast=function(e,i,s,o){for(var n=t.MathUtils.mul(s.q,i.point1.sub(s.p)),r=t.MathUtils.mul(s.q,i.point2.sub(s.p)).sub(n),a=0,h=i.maxFraction,c=-1,u=0;u<this.vertices.length;++u){var l=this.normals[u].dot(this.vertices[u].sub(n)),p=this.normals[u].dot(r);if(0==p){if(l<0)return!1}else p<0&&l<a*p?(a=l/p,c=u):p>0&&l<h*p&&(h=l/p);if(h<a)return!1}return console.assert(0<=a&&a<=i.maxFraction),c>=0&&(e.fraction=a,e.normal=t.MathUtils.mul(s.q,this.normals[c]),!0)},i.prototype.computeAABB=function(e,i,s){for(var o=t.MathUtils.mul(i,this.vertices[0]),n=o.clone(),r=1;r<this.vertices.length;++r){var a=t.MathUtils.mul(i,this.vertices[r]);o=es.Vector2.min(o,a),n=es.Vector2.max(n,a)}var h=new es.Vector2(this.radius,this.radius);e.lowerBound=o.sub(h),e.upperBound=es.Vector2.add(n,h)},i.prototype.computeSubmergedArea=function(e,i,s,o){o.x=0,o.y=0;var n,r=t.MathUtils.mul(s.q,e),a=i-e.dot(s.p),h=[],c=0,u=-1,l=-1,p=!1;for(n=0;n<this.vertices.length;n++){h[n]=r.dot(this.vertices[n])-a;var d=h[n]<-t.Settings.epsilon;n>0&&(d?p||(u=n-1,c++):p&&(l=n-1,c++)),p=d}switch(c){case 0:return p?(o=t.MathUtils.mul(s,this.massData.centroid),this.massData.mass/this.density):0;case 1:-1==u?u=this.vertices.length-1:l=this.vertices.length-1}var f=(u+1)%this.vertices.length,y=(l+1)%this.vertices.length,v=(0-h[u])/(h[f]-h[u]),_=(0-h[l])/(h[y]-h[l]),g=new es.Vector2(this.vertices[u].x*(1-v)+this.vertices[f].x*v,this.vertices[u].y*(1-v)+this.vertices[f].y*v),x=new es.Vector2(this.vertices[l].x*(1-_)+this.vertices[y].x*_,this.vertices[l].y*(1-_)+this.vertices[y].y*_),b=0,m=new es.Vector2(0,0),w=this.vertices[f];for(n=f;n!=y;){var C=void 0;C=(n=(n+1)%this.vertices.length)==y?x:this.vertices[n];var B=w.sub(g),A=C.sub(g),S=.5*t.MathUtils.cross(B,A);b+=S,m.add(es.Vector2.add(g,w).add(C).multiplyScaler(S*(1/3))),w=C.clone()}return m.multiplyScaler(1/b),o=t.MathUtils.mul(s,m),b},i.prototype.clone=function(){var e=new i;return e.shapeType=this.shapeType,e._radius=this._radius,e._density=this._density,e._vertices=new t.Vertices(this._vertices),e._normals=new t.Vertices(this._normals),e.massData=this.massData,e},i}(t.Shape);t.PolygonShape=e}(physics||(physics={})),function(t){var e=function(){function t(){}return t.simToDisplay=100,t.displayToSim=1/t.simToDisplay,t}();t.FSConvert=e}(physics||(physics={})),function(t){var e=function(){function t(){}return t.prototype.get=function(t){switch(t){case 0:return this._value0;case 1:return this._value1;default:throw new Error("index out of range")}},t.prototype.set=function(t,e){switch(t){case 0:this._value0=e;break;case 1:this._value1=e;break;default:throw new Error("index out of range")}},t}();t.FixedArray2=e;var i=function(){function t(){}return t.prototype.get=function(t){switch(t){case 0:return this._value0;case 1:return this._value1;case 2:return this._value2;default:throw new Error("index out of range")}},t.prototype.set=function(t,e){switch(t){case 0:this._value0=e;break;case 1:this._value1=e;break;case 2:this._value2=e;break;default:throw new Error("index out of range")}},t}();t.FixedArray3=i}(physics||(physics={})),function(t){var e=function(){function t(){}return t.prototype.getTransform=function(t,e){t.p.x=(1-e)*this.c0.x+e*this.c.x,t.p.y=(1-e)*this.c0.y+e*this.c.y;var i=(1-e)*this.a0+e*this.a;t.q.set(i),t.p.sub(o.mul(t.q,this.localCenter))},t.prototype.advance=function(t){console.assert(this.alpha0<1);var e=(t-this.alpha0)/(1-this.alpha0);this.c0.add(this.c.sub(this.c0).multiplyScaler(e)),this.a0+=e*(this.a-this.a0),this.alpha0=t},t.prototype.normalize=function(){var t=2*Math.PI*Math.floor(this.a0/(2*Math.PI));this.a0-=t,this.a-=t},t}();t.Sweep=e;var i=function(){function t(t,e){this.p=t,this.q=e}return t.prototype.setIdentity=function(){this.p=es.Vector2.zero,this.q.setIdentity()},t.prototype.set=function(t,e){this.p=t,this.q.set(e)},t}();t.Transform=i;var s=function(){function t(t){this.s=Math.sin(t),this.c=Math.cos(t)}return t.prototype.set=function(t){0==t?(this.s=0,this.c=1):(this.s=Math.sin(t),this.c=Math.cos(t))},t.prototype.setIdentity=function(){this.s=0,this.c=1},t.prototype.getAngle=function(){return Math.atan2(this.s,this.c)},t.prototype.getXAxis=function(){return new es.Vector2(this.c,this.s)},t.prototype.getYAxis=function(){return new es.Vector2(-this.s,this.c)},t}();t.Rot=s;var o=function(){function t(){}return t.mul=function(t,e){if(t instanceof i&&e instanceof es.Vector2){var o=t.q.c*e.x-t.q.s*e.y+t.p.x,r=t.q.s*e.x+t.q.c*e.y+t.p.y;return new es.Vector2(o,r)}if(t instanceof s&&e instanceof es.Vector2)return new es.Vector2(t.c*e.x-t.s*e.y,t.s*e.x+t.c*e.y);if(t instanceof n&&e instanceof es.Vector2)return new es.Vector2(e.x*t.ex.x+e.y*t.ex.y,e.x*t.ey.x+e.y*t.ey.y);if(t instanceof s&&e instanceof s){var a=new s(0);return a.s=t.c*e.s-t.s*e.c,a.c=t.c*e.c+t.s*e.s,a}return t instanceof s&&e instanceof es.Vector2?new es.Vector2(t.c*e.x+t.s*e.y,-t.s*e.x+t.c*e.y):void 0},t.mulT=function(t,e){return new es.Vector2(t.c*e.x+t.s*e.y,-t.s*e.x+t.c*e.y)},t.cross=function(t,e){return t.x*e.y-t.y*e.x},t}();t.MathUtils=o;var n=function(){return function(t,e){this.ex=t,this.ey=e}}();t.Mat22=n}(physics||(physics={})),function(t){!function(t){t[t.noError=0]="noError",t[t.invalidAmountOfVertices=1]="invalidAmountOfVertices",t[t.notSimple=2]="notSimple",t[t.notCounterClockWise=3]="notCounterClockWise",t[t.notConvex=4]="notConvex",t[t.areaTooSmall=5]="areaTooSmall",t[t.sideTooSmall=6]="sideTooSmall"}(t.PolygonError||(t.PolygonError={}));var e=function(e){function i(t){var i,s;void 0===t&&(t=null);var o=e.call(this)||this;if(t)try{for(var n=__values(t),r=n.next();!r.done;r=n.next()){var a=r.value;o.push(a)}}catch(t){i={error:t}}finally{try{r&&!r.done&&(s=n.return)&&s.call(n)}finally{if(i)throw i.error}}return o}return __extends(i,e),i.prototype.nextIndex=function(t){return t+1>this.length-1?0:t+1},i.prototype.nextVertex=function(t){return this[this.nextIndex(t)]},i.prototype.previousIndex=function(t){return t-1<0?this.length-1:t-1},i.prototype.previousVertx=function(t){return this[this.previousIndex(t)]},i.prototype.getSignedArea=function(){if(this.length<3)return 0;var t,e=0;for(t=0;t<this.length;t++){var i=(t+1)%this.length,s=this[t],o=this[i];e+=s.x*o.y,e-=s.y*o.x}return e/=2},i.prototype.getArea=function(){var t=this.getSignedArea();return t<0?-t:t},i.prototype.getCentroid=function(){if(this.length<3)return new es.Vector2(Number.NaN,Number.NaN);for(var t=es.Vector2.zero,e=0,i=0;i<this.length;++i){var s=this[i],o=i+1<this.length?this[i+1]:this[0],n=.5*(s.x*o.y-s.y*o.x);e+=n,t.add(s.add(o).scale(n*(1/3)))}return t.multiplyScaler(1/e),t},i.prototype.getAABB=function(){for(var e=new es.Vector2(Number.MAX_VALUE,Number.MAX_VALUE),i=new es.Vector2(Number.MIN_VALUE,Number.MIN_VALUE),s=0;s<this.length;++s)this[s].x<e.x&&(e.x=this[s].x),this[s].x>i.x&&(i.x=this[s].x),this[s].y<e.y&&(e.y=this[s].y),this[s].y>i.y&&(i.y=this[s].y);return new t.AABB(e,i)},i.prototype.translate=function(t){var e,i;console.assert(!this.attackedToBody,"平移实体所使用的顶点可能会导致行为不稳定。 使用Body.Position代替 ");for(var s=0;s<this.length;s++)this[s]=es.Vector2.add(this[s],t);if(null!=this.holes&&this.holes.length>0)try{for(var o=__values(this.holes),n=o.next();!n.done;n=o.next()){n.value.translate(t)}}catch(t){e={error:t}}finally{try{n&&!n.done&&(i=o.return)&&i.call(o)}finally{if(e)throw e.error}}},i.prototype.scale=function(t){var e,i;console.assert(!this.attackedToBody,"Body使用的缩放顶点会导致行为不稳定 ");for(var s=0;s<this.length;s++)this[s]=this[s].multiply(t);if(null!=this.holes&&this.holes.length>0)try{for(var o=__values(this.holes),n=o.next();!n.done;n=o.next()){n.value.scale(t)}}catch(t){e={error:t}}finally{try{n&&!n.done&&(i=o.return)&&i.call(o)}finally{if(e)throw e.error}}},i.prototype.rotate=function(t){var e,i;console.assert(!this.attackedToBody,"Body使用的旋转顶点可能会导致行为不稳定 ");for(var s=Math.cos(t),o=Math.sin(t),n=0;n<this.length;n++){var r=this[n];this[n]=new es.Vector2(r.x*s+r.y*-o,r.x*o+r.y*s)}if(null!=this.holes&&this.holes.length>0)try{for(var a=__values(this.holes),h=a.next();!h.done;h=a.next()){h.value.rotate(t)}}catch(t){e={error:t}}finally{try{h&&!h.done&&(i=a.return)&&i.call(a)}finally{if(e)throw e.error}}},i.prototype.isConvex=function(){if(this.length<3)return!1;if(3==this.length)return!0;for(var t=0;t<this.length;++t)for(var e=t+1<this.length?t+1:0,i=this[e].sub(this[t]),s=0;s<this.length;++s)if(s!=t&&s!=e){var o=this[s].sub(this[t]);if(i.x*o.y-i.y*o.x<=0)return!1}return!0},i.prototype.isCounterClockWise=function(){return!(this.length<3)&&this.getSignedArea()>0},i.prototype.forceCounterClockWise=function(){this.length<3||this.isCounterClockWise()||this.reverse()},i}(Array);t.Vertices=e}(physics||(physics={})),function(t){var e=function(){function e(){}return e.getConvexHull=function(e){if(e.length<=3)return e;for(var i=0,s=e[0].x,o=1;o<e.length;++o){var n=e[o].x;(n>s||n==s&&e[o].y<e[i].y)&&(i=o,s=n)}for(var r=[],a=0,h=i;;){r[a]=h;for(var c=0,u=1;u<e.length;++u)if(c!=h){var l=e[c].sub(e[r[a]]),p=e[u].sub(e[r[a]]),d=t.MathUtils.cross(l,p);d<0&&(c=u),0==d&&p.lengthSquared()>l.lengthSquared()&&(c=u)}else c=u;if(++a,h=c,c==i)break}var f=new t.Vertices;for(o=0;o<a;++o)f.push(e[r[o]]);return f},e}();t.GiftWrap=e}(physics||(physics={})),function(t){var e=function(){function e(){this.disabledOnCategories=t.Category.none,this.enabledOnCategories=t.Category.all}return e.prototype.isActiveOn=function(e){var i,s;if(null==e||!e.enabled||e.isStatic)return!1;if(null==e.fixtureList)return!1;try{for(var o=__values(e.fixtureList),n=o.next();!n.done;n=o.next()){var r=n.value;if(r.collisionGroup==this.disabledOnGroup&&0!=r.collisionGroup&&0!=this.disabledOnGroup)return!1;if((r.collisionCategories&this.disabledOnCategories)!=t.Category.none)return!1;if(0==this.enabledOnGroup&&this.enabledOnCategories==t.Category.all)return!0;if(r.collisionGroup==this.enabledOnGroup&&0!=r.collisionGroup&&0!=this.enabledOnGroup)return!0;if((r.collisionCategories&this.enabledOnGroup)!=t.Category.none&&this.enabledOnCategories!=t.Category.all)return!0}}catch(t){i={error:t}}finally{try{n&&!n.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}return!1},e}();t.FilterData=e}(physics||(physics={})),function(t){!function(t){t[t.Explosion=1]="Explosion"}(t.PhysicsLogicType||(t.PhysicsLogicType={}));var e=function(){function t(){}return t.prototype.ignorePhysicsLogic=function(t){this.controllerIgnores|=t},t}();t.PhysicsLogicFilter=e}(physics||(physics={})),function(t){!function(t){t[t.gravityController=1]="gravityController",t[t.velocityLimitController=2]="velocityLimitController",t[t.abstractForceController=4]="abstractForceController",t[t.buoyancyController=8]="buoyancyController"}(t.ControllerType||(t.ControllerType={}));var e=function(){function t(){}return t.prototype.ignoreController=function(t){this.controllerFlags|=t},t.prototype.restoreController=function(t){this.controllerFlags&=~t},t.prototype.isControllerIgnored=function(t){return(this.controllerFlags&t)==t},t}();t.ControllerFilter=e;var i=function(t){function e(e){var i=t.call(this)||this;return i._type=e,i}return __extends(e,t),e.prototype.isActiveOn=function(e){return!e.controllerFilter.isControllerIgnored(this._type)&&t.prototype.isActiveOn.call(this,e)},e}(t.FilterData);t.Controller=i}(physics||(physics={})),function(t){var e;!function(t){t[t.static=0]="static",t[t.kinematic=1]="kinematic",t[t.dynamic=2]="dynamic"}(e=t.BodyType||(t.BodyType={}));var i=function(){function i(t,s,o,n,r){void 0===s&&(s=new es.Vector2),void 0===o&&(o=0),void 0===n&&(n=e.static),void 0===r&&(r=null),this.fixtureList=[],this.bodyId=i._bodyIdCounter++,this._world=t,this._enabled=!0,this._awake=!0,this._sleepingAllowed=!0,this.userData=r,this.gravityScale=1,this.bodyType=n,this._xf.q.set(o),s.equals(es.Vector2.zero)||(this._xf.p=s,this._sweep.c0=this._xf.p,this._sweep.c=this._xf.p),0!=o&&(this._sweep.a0=o,this._sweep.a=o),this.world.addBody(this)}return Object.defineProperty(i.prototype,"world",{get:function(){return this._world},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"revolutions",{get:function(){return this.rotation/Math.PI},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bodyType",{get:function(){return this._bodyType},set:function(t){this._bodyType!=t&&(this._bodyType=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"linearVelocity",{get:function(){return this._linearVelocity},set:function(t){console.assert(!Number.isNaN(t.x)&&!Number.isNaN(t.y)),this._bodyType!=e.static&&(t.dot(t)>0&&(this.isAwake=!0),this._linearVelocity=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"angularVelocity",{get:function(){return this._angularVelocity},set:function(t){console.assert(!Number.isNaN(t)),this._bodyType!=e.static&&(t*t>0&&(this.isAwake=!0),this._angularVelocity=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"linearDamping",{get:function(){return this._linearDamping},set:function(t){console.assert(!Number.isNaN(t)),this._linearDamping=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"angularDamping",{get:function(){return this._angularDamping},set:function(t){console.assert(!Number.isNaN(t)),this._angularDamping=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isSleepingAllowed",{get:function(){return this._sleepingAllowed},set:function(t){t||(this.isAwake=!0),this._sleepingAllowed=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isAwake",{get:function(){return this._awake},set:function(t){t&&(this._awake||(this._sleepTime=0))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"enabled",{set:function(t){if(t!=this._enabled){if(t)for(var e=this._world.contactManager.broadPhase,i=0;i<this.fixtureList.length;i++)this.fixtureList[i].createProxies(e,this._xf);else{for(e=this._world.contactManager.broadPhase,i=0;i<this.fixtureList.length;i++)this.fixtureList[i].destroyProxies(e);for(var s=this.contactList;null!=s;){var o=s;s=s.next,this._world.contactManager.destroy(o.contact)}this.contactList=null}this._enabled=t}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fixedRotation",{get:function(){return this._fixedRotation},set:function(t){this._fixedRotation!=t&&(this._fixedRotation=t,this._angularVelocity=0,this.resetMassData())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"position",{get:function(){return this._xf.p},set:function(t){console.assert(!Number.isNaN(t.x)&&!Number.isNaN(t.y)),this.setTransform(t,this.rotation)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"displayPosition",{get:function(){return this._xf.p.scale(t.FSConvert.simToDisplay)},set:function(e){this.position=e.scale(t.FSConvert.displayToSim)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotation",{get:function(){return this._sweep.a},set:function(t){console.assert(!Number.isNaN(t)),this.setTransform(this._xf.p,t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isStatic",{get:function(){return this._bodyType==e.static},set:function(t){this.bodyType=t?e.static:e.dynamic},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isKinematic",{get:function(){return this._bodyType==e.kinematic},set:function(t){this.bodyType=t?e.kinematic:e.dynamic},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isDynamic",{get:function(){return this._bodyType==e.dynamic},set:function(t){this.bodyType=t?e.dynamic:e.kinematic},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"worldCenter",{get:function(){return this._sweep.c},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"localCenter",{get:function(){return this._sweep.localCenter},set:function(i){if(this._bodyType==e.dynamic){var s=this._sweep.c.clone();this._sweep.localCenter=i,this._sweep.c0=this._sweep.c=t.MathUtils.mul(this._xf,this._sweep.localCenter);var o=this._sweep.c.sub(s);this._linearVelocity.add(new es.Vector2(-this._angularVelocity*o.y,this._angularVelocity*o.x))}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"mass",{get:function(){return this._mass},set:function(t){console.assert(!Number.isNaN(t)),this._bodyType==e.dynamic&&(this._mass=t,this._mass<=0&&(this._mass=1),this._invMass=1/this._mass)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"inertia",{get:function(){return this._inertia+this.mass*this._sweep.localCenter.dot(this._sweep.localCenter)},set:function(t){console.assert(!Number.isNaN(t)),this._bodyType==e.dynamic&&t>0&&!this._fixedRotation&&(this._inertia=t-this.mass*this.localCenter.dot(this.localCenter),console.assert(this._inertia>0),this._invI=1/this._inertia)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"restitution",{get:function(){for(var t=0,e=0;e<this.fixtureList.length;e++){t+=this.fixtureList[e].restitution}return this.fixtureList.length>0?t/this.fixtureList.length:0},set:function(t){for(var e=0;e<this.fixtureList.length;e++){this.fixtureList[e].restitution=t}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"friction",{get:function(){for(var t=0,e=0;e<this.fixtureList.length;e++){t+=this.fixtureList[e].friction}return this.fixtureList.length>0?t/this.fixtureList.length:0},set:function(t){for(var e=0;e<this.fixtureList.length;e++){this.fixtureList[e].friction=t}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"collisionCategories",{set:function(t){for(var e=0;e<this.fixtureList.length;e++){this.fixtureList[e].collisionCategories=t}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"collidesWith",{set:function(t){for(var e=0;e<this.fixtureList.length;e++){this.fixtureList[e].collidesWith=t}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"ignoreCCDWith",{set:function(t){for(var e=0;e<this.fixtureList.length;e++){this.fixtureList[e].ignoreCCDWith=t}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"collisionGroup",{set:function(t){for(var e=0;e<this.fixtureList.length;e++){this.fixtureList[e].collisionGroup=t}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isSensor",{set:function(t){for(var e=0;e<this.fixtureList.length;e++){this.fixtureList[e].isSensor=t}},enumerable:!0,configurable:!0}),i.prototype.addOnCollision=function(t){for(var e=0;e<this.fixtureList.length;e++)this.fixtureList[e].onCollision.push(t)},i.prototype.removeOnCollision=function(t){for(var e=0;e<this.fixtureList.length;e++)new es.List(this.fixtureList[e].onCollision).remove(t)},i.prototype.addOnSeparation=function(t){for(var e=0;e<this.fixtureList.length;e++)this.fixtureList[e].onSeperation.push(t)},i.prototype.removeOnSeparation=function(t){for(var e=0;e<this.fixtureList.length;e++)new es.List(this.fixtureList[e].onSeperation).remove(t)},i.prototype.resetDynamics=function(){this._torque=0,this._angularVelocity=0,this._force=es.Vector2.zero,this._linearVelocity=es.Vector2.zero},i.prototype.createFixture=function(e,i){return void 0===i&&(i=null),new t.Fixture(this,e,i)},i.prototype.destroyFixture=function(t){console.assert(t.body==this),console.assert(this.fixtureList.length>0),console.assert(new es.List(this.fixtureList).contains(t));for(var e=this.contactList;null!=e;){var i=e.contact;e=e.next;var s=i.fixtureA,o=i.fixtureB;t!=s&&t!=o||this._world.contactManager.destroy(i)}if(this._enabled){var n=this._world.contactManager.broadPhase;t.destroyProxies(n)}new es.List(this.fixtureList).remove(t),t.destroy(),t.body=null,this.resetMassData()},i.prototype.setTransform=function(t,e){this.setTransformIgnoreContacts(t,e),this._world.contactManager.findNewContacts()},i.prototype.setTransformIgnoreContacts=function(e,i){this._xf.q.set(i),this._xf.p=e,this._sweep.c=t.MathUtils.mul(this._xf,this._sweep.localCenter),this._sweep.a=i,this._sweep.c0=this._sweep.c,this._sweep.a0=i;for(var s=this._world.contactManager.broadPhase,o=0;o<this.fixtureList.length;o++)this.fixtureList[o].synchronize(s,this._xf,this._xf)},i.prototype.resetMassData=function(){if(this._mass=0,this._invMass=0,this._inertia=0,this._invI=0,this._sweep.localCenter=es.Vector2.zero,this.bodyType==e.kinematic)return this._sweep.c0=this._xf.p,this._sweep.c=this._xf.p,void(this._sweep.a0=this._sweep.a);console.assert(this.bodyType==e.dynamic||this.bodyType==e.static);for(var i=es.Vector2.zero,s=0;s<this.fixtureList.length;s++){var o=this.fixtureList[s];if(0!=o.shape._density){var n=o.shape.massData;this._mass+=n.mass,this.localCenter=this.localCenter.add(n.centroid.scale(n.mass)),this._inertia+=n.inertia}}if(this.bodyType!=e.static){this._mass>0?(this._invMass=1/this._mass,i=i.scale(this._invMass)):(this._mass=1,this._invMass=1),this._invMass>0&&!this._fixedRotation?(this._inertia-=this._mass*i.dot(i),console.assert(this._inertia>0),this._invI=1/this._inertia):(this._inertia=0,this._invI=0);var r=this._sweep.c;this._sweep.localCenter=i,this._sweep.c0=this._sweep.c=t.MathUtils.mul(this._xf,this._sweep.localCenter);var a=this._sweep.c.sub(r);this._linearVelocity=this._linearVelocity.add(new es.Vector2(-this._angularVelocity*a.y,this._angularVelocity*a.x))}else this._sweep.c0=this._sweep.c=this._xf.p},i.prototype.shouldCollide=function(t){if(this._bodyType!=e.dynamic&&t._bodyType!=e.dynamic)return!1;for(var i=this.jointList;null!=i;i=i.next)if(i.other==t&&0==i.joint.collideConnected)return!1;return!0},i}();t.Body=i}(physics||(physics={})),function(t){var e=function(){function e(t,e,i,s,o){void 0===s&&(s=new es.Vector2),void 0===o&&(o=0),this.parts=[],this.strength=500,this._angularVelocitiesCache=[],this._velocitiesCache=[],this._world=t,this._world.contactManager.onPostSolve.push(this.onPostSolve)}return e.prototype.onPostSolve=function(t,e){if(!this.isBroken){var i=new es.List(this.parts);if(i.contains(t.fixtureA)||i.contains(t.fixtureB)){for(var s=0,o=t.manifold.pointCount,n=0;n<o;++n)s=Math.max(s,e.points[n].normalImpulse);s>this.strength&&(this._break=!0)}}},e.prototype.update=function(){if(this._break&&(this.decompose(),this.isBroken=!0,this._break=!1),0==this.isBroken){this.parts.length>this._angularVelocitiesCache.length&&(this._velocitiesCache=[],this._angularVelocitiesCache=[]);for(var t=0;t<this.parts.length;t++)this._velocitiesCache[t]=this.parts[t].body.linearVelocity,this._angularVelocitiesCache[t]=this.parts[t].body.angularVelocity}},e.prototype.decompose=function(){new es.List(this._world.contactManager.onPostSolve).remove(this.onPostSolve);for(var e=0;e<this.parts.length;e++){var i=this.parts[e],s=i.shape.clone(),o=i.userData;this.mainBody.destroyFixture(i);var n=t.BodyFactory.createBody(this._world,this.mainBody.position,this.mainBody.rotation,t.BodyType.dynamic,this.mainBody.userData),r=n.createFixture(s);r.userData=o,this.parts[e]=r,n.angularVelocity=this._angularVelocitiesCache[e],n.linearVelocity=this._velocitiesCache[e]}this._world.removeBody(this.mainBody),this._world.removeBreakableBody(this)},e}();t.BreakableBody=e}(physics||(physics={})),function(t){var e=function(){function e(t){this.contactList=[],this.activeContacts=new Set,this.activeList=[],this.broadPhase=t,this.onBroadphaseCollision.push(this.addPair)}return e.prototype.addPair=function(t,e){var i=t.fixture,s=e.fixture,o=t.childIndex,n=e.childIndex,r=i.body,a=s.body;if(r!=a)for(var h=a.contactList;null!=h;){if(h.other==r){var c=h.contact.fixtureA,u=h.contact.fixtureB,l=h.contact.childIndexA,p=h.contact.childIndexB;if(c==i&&u==s&&l==o&&p==n)return;if(c==s&&u==i&&l==n&&p==o)return}h=h.next}},e.prototype.findNewContacts=function(){},e.prototype.destroy=function(t){var e=t.fixtureA,i=t.fixtureB,s=e.body,o=i.body;t.isTouching&&(null!=e&&null!=e.onSeperation&&e.onSeperation.forEach(function(t){return t(e,i)}),null!=i&&null!=i.onSeperation&&i.onSeperation.forEach(function(t){return t(i,e)}),null!=this.onEndContact&&this.onEndContact.forEach(function(e){return e(t)})),new es.List(this.contactList).remove(t),null!=t._nodeA.prev&&(t._nodeA.prev.next=t._nodeA.next),null!=t._nodeA.next&&(t._nodeA.next.prev=t._nodeA.prev),t._nodeA==s.contactList&&(s.contactList=t._nodeA.next),null!=t._nodeB.prev&&(t._nodeB.prev.next=t._nodeB.next),null!=t._nodeB.next&&(t._nodeB.next.prev=t._nodeB.prev),t._nodeB==o.contactList&&(o.contactList=t._nodeB.next),this.activeContacts.has(t)&&this.activeContacts.delete(t),t.destroy()},e.prototype.collide=function(){var i=[];t.Defined.USE_ACTIVE_CONTACT_SET?(this.activeList.concat(Array.from(this.activeContacts)),i=this.activeList):i=this.contactList;for(var s=0;s<i.length;s++){var o=i[s],n=o.fixtureA,r=o.fixtureB,a=o.childIndexA,h=o.childIndexB,c=n.body,u=r.body;if(c.enabled&&u.enabled){if(o.filterFlag){if(0==u.shouldCollide(c)){var l=o;this.destroy(l);continue}if(0==e.shouldCollide(n,r)){l=o;this.destroy(l);continue}if(null!=this.onContactFilter&&0==this.onContactFilter(n,r)){l=o;this.destroy(l);continue}o.filterFlag=!1}var p=c.isAwake&&c.bodyType!=t.BodyType.static,d=u.isAwake&&u.bodyType!=t.BodyType.static;if(0!=p||0!=d){var f=n.proxies[a].proxyId,y=r.proxies[h].proxyId;if(0!=this.broadPhase.testOverlap(f,y))o.update(this);else{l=o;this.destroy(l)}}else t.Defined.USE_ACTIVE_CONTACT_SET&&this.activeContacts.delete(o)}}},e.shouldCollide=function(e,i){if(t.Settings.useFPECollisionCategories)return(e.collisionGroup!=i.collisionGroup||0==e.collisionGroup||0==i.collisionGroup)&&(!(Number((e.collisionCategories&i.collidesWith)==t.Category.none)&Number((i.collisionCategories&e.collidesWith)==t.Category.none))&&(!e.isFixtureIgnored(i)&&!i.isFixtureIgnored(e)));if(e.collisionGroup==i.collisionGroup&&0!=e.collisionGroup)return e.collisionGroup>0;var s=0!=(e.collidesWith&i.collisionCategories)&&0!=(e.collisionCategories&i.collidesWith);return(!s||!e.isFixtureIgnored(i)&&!i.isFixtureIgnored(e))&&s},e}();t.ContactManager=e}(physics||(physics={})),function(t){var e=function(){return function(){}}();t.Island=e}(physics||(physics={})),function(t){var e=function(){return function(){}}();t.TimeStep=e;var i=function(){return function(){}}();t.Position=i;var s=function(){return function(){}}();t.Velocity=s;var o=function(){return function(){}}();t.SolverData=o}(physics||(physics={})),function(t){var e=function(){function e(e){this._tempOverlapCircle=new t.CircleShape,this._stack=[],this._bodyAddList=new Set,this._bodyRemoveList=new Set,this._jointAddList=new Set,this._jointRemoveList=new Set,this._input=new t.TOIInput,this._watch=new es.Stopwatch,this._contactPool=[],this.island=new t.Island,this.enabled=!0,this.controllerList=[],this.breakableBodyList=[],this.bodyList=[],this.jointList=[],this.awakeBodySet=new Set,this.awakeBodyList=[],this.islandSet=new Set,this.TOISet=new Set,this._queryAABBCallbackWrpper=this.queryAABBCallbackWrapper,this._rayCastCallbackWrapper=this.raycastCallbackWrapper,this.gravity=e}return Object.defineProperty(e.prototype,"proxyCount",{get:function(){return this.contactManager.broadPhase.proxyCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contactList",{get:function(){return this.contactManager.contactList},enumerable:!0,configurable:!0}),e.prototype.processChanges=function(){},e.prototype.addBody=function(t){console.assert(!this._bodyAddList.has(t),"You are adding the same body more than once."),this._bodyAddList.has(t)||this._bodyAddList.add(t)},e.prototype.removeBody=function(t){console.assert(!this._bodyRemoveList.has(t),"The body is already marked for removal. You are removing the body more than once."),this._bodyRemoveList.has(t)||this._bodyRemoveList.add(t),this.awakeBodySet.has(t)&&this.awakeBodySet.delete(t)},e.prototype.addBreakableBody=function(t){this.breakableBodyList.push(t)},e.prototype.removeBreakableBody=function(t){console.assert(-1!=this.breakableBodyList.indexOf(t)),this.breakableBodyList.splice(this.breakableBodyList.indexOf(t),1)},e.prototype.queryAABBCallbackWrapper=function(t){var e=this.contactManager.broadPhase.getProxy(t);return this._queryAABBCallback(e.fixture)},e.prototype.raycastCallbackWrapper=function(t,e){var i=this.contactManager.broadPhase.getProxy(e),s=i.fixture,o=i.childIndex;if(s.rayCast(void 0,t,o)){var n=(void 0).fraction,r=t.point1.scale(1-n).add(t.point2.scale(n));return this._rayCastCallback(s,r,(void 0).normal,n)}return t.maxFraction},e.prototype.step=function(e){if(this.enabled){t.Settings.enableDiagnostics&&this._watch.start(),this.processChanges(),t.Settings.enableDiagnostics&&(this.addRemoveTime=this._watch.getTime()),this._worldHasNewFixture&&(this.contactManager.findNewContacts(),this._worldHasNewFixture=!1),t.Settings.enableDiagnostics&&(this.newContactsTime=this._watch.getTime()-this.addRemoveTime);var i=new t.TimeStep;i.inv_dt=e>0?1/e:0,i.dt=e,i.dtRatio=this._invDt0*e;for(var s=0;s<this.controllerList.length;s++)this.controllerList[s].update(e);t.Settings.enableDiagnostics&&(this.controllersUpdateTime=this._watch.getTime()-(this.addRemoveTime+this.newContactsTime)),this.contactManager.collide(),t.Settings.enableDiagnostics&&(this.ContactsUpdateTime=this._watch.getTime()-(this.addRemoveTime+this.newContactsTime+this.controllersUpdateTime))}},e.prototype.clear=function(){this.processChanges()},e}();t.World=e}(physics||(physics={})),function(t){var e;!function(t){t[t.notSupported=0]="notSupported",t[t.polygon=1]="polygon",t[t.polygonAndCircle=2]="polygonAndCircle",t[t.circle=3]="circle",t[t.edgeAndPolygon=4]="edgeAndPolygon",t[t.edgeAndCircle=5]="edgeAndCircle",t[t.chainAndPolygon=6]="chainAndPolygon",t[t.chainAndCircle=7]="chainAndCircle"}(e=t.ContactType||(t.ContactType={}));var i=function(){function i(t,e,i,o){this._nodeA=new s,this._nodeB=new s}return i.prototype.resetRestitution=function(){this.restitution=t.Settings.mixRestitution(this.fixtureA.restitution,this.fixtureB.restitution)},i.prototype.resetFriction=function(){this.friction=t.Settings.mixFriction(this.fixtureA.friction,this.fixtureB.friction)},i.prototype.getWorldManifold=function(t,e){this.fixtureA.body,this.fixtureA.body,this.fixtureA.shape,this.fixtureB.shape},i.prototype.reset=function(e,i,s,o){this.enabled=!0,this.isTouching=!1,this.islandFlag=!1,this.filterFlag=!1,this.toiFlag=!1,this.fixtureA=e,this.fixtureB=s,this.childIndexA=i,this.childIndexB=o,this.manifold.pointCount=0,this._nodeA.contact=null,this._nodeA.prev=null,this._nodeA.next=null,this._nodeA.other=null,this._nodeB.contact=null,this._nodeB.prev=null,this._nodeB.next=null,this._nodeB.other=null,this._toiCount=0,null!=this.fixtureA&&null!=this.fixtureB&&(this.friction=t.Settings.mixFriction(this.fixtureA.friction,this.fixtureB.friction),this.restitution=t.Settings.mixRestitution(this.fixtureA.restitution,this.fixtureB.restitution)),this.tangentSpeed=0},i.prototype.update=function(e){var i=this.fixtureA.body,s=this.fixtureB.body;if(null!=this.fixtureA&&null!=this.fixtureB){this.manifold;this.enabled=!0;this.isTouching;if(this.fixtureA.isSensor||this.fixtureB.isSensor){var o=this.fixtureA.shape,n=this.fixtureB.shape;t.Collision.testOverlap(o,this.childIndexA,n,this.childIndexB,i._xf,s._xf),this.manifold.pointCount=0}}},i.prototype.destroy=function(){this.fixtureA.body._world._contactPool.unshift(this),this.manifold.pointCount>0&&0==this.fixtureA.isSensor&&0==this.fixtureB.isSensor&&(this.fixtureA.body.isAwake=!0,this.fixtureB.body.isAwake=!0)},i._edge=new t.EdgeShape,i._contactRegisters=[[e.circle,e.edgeAndCircle,e.polygonAndCircle,e.chainAndCircle],[e.edgeAndCircle,e.notSupported,e.edgeAndCircle,e.notSupported],[e.polygonAndCircle,e.edgeAndPolygon,e.polygon,e.chainAndPolygon],[e.chainAndCircle,e.notSupported,e.chainAndPolygon,e.notSupported]],i}();t.Contact=i;var s=function(){return function(){}}();t.ContactEdge=s}(physics||(physics={})),function(t){var e=function(){return function(){}}();t.VelocityConstraintPoint=e;var i=function(){return function(){this.points=[]}}();t.ContactVelocityConstraint=i;var s=function(){function t(){}return t.prototype.reset=function(t,e,i,s,o){this._step=t,this._count=e,this._positions=s,this._velocities=o,this._contacts=i},t}();t.ContactSolver=s}(physics||(physics={})),function(t){var e=function(){function e(){}return e.createBody=function(e,i,s,o,n){return void 0===i&&(i=new es.Vector2),void 0===s&&(s=0),void 0===o&&(o=t.BodyType.static),void 0===n&&(n=null),new t.Body(e,i,s,o,n)},e}();t.BodyFactory=e}(physics||(physics={})),function(t){var e;!function(t){t[t.unknown=0]="unknown",t[t.revolute=1]="revolute",t[t.prismatic=2]="prismatic",t[t.distance=3]="distance",t[t.pulley=4]="pulley",t[t.gear=5]="gear",t[t.wheel=6]="wheel",t[t.weld=7]="weld",t[t.friction=8]="friction",t[t.rope=9]="rope",t[t.motor=10]="motor",t[t.angle=11]="angle",t[t.fixedMouse=12]="fixedMouse"}(e=t.JointType||(t.JointType={})),function(t){t[t.inactive=0]="inactive",t[t.atLower=1]="atLower",t[t.atUpper=2]="atUpper",t[t.equal=3]="equal"}(t.LimitState||(t.LimitState={}));var i=function(){return function(){}}();t.JointEdge=i;var s=function(){function t(t,e){this.enabled=!0,this.edgeA=new i,this.edgeB=new i,t&&e?(console.assert(t!=e),this.bodyA=t,this.bodyB=e):t&&(this.bodyA=t),this.breakpoint=Number.MAX_VALUE,this.collideConnected=!1}return Object.defineProperty(t.prototype,"breakpoint",{get:function(){return this._breakpoint},set:function(t){this._breakpoint=t,this._breakpointSquared=this._breakpoint*this._breakpoint},enumerable:!0,configurable:!0}),t.prototype.wakeBodies=function(){null!=this.bodyA&&(this.bodyA.isAwake=!0),null!=this.bodyB&&(this.bodyB.isAwake=!0)},t.prototype.isFixedType=function(){return this.jointType==e.fixedMouse||this.bodyA.isStatic||this.bodyB.isStatic},t}();t.Joint=s}(physics||(physics={})),function(t){var e=function(e){function i(i){void 0===i&&(i=new es.Vector2(0,9.82));var s=e.call(this)||this;return s.world=new t.World(i),s}return __extends(i,e),i.prototype.onEnabled=function(){this.world.enabled=!0},i.prototype.onDisabled=function(){this.world.enabled=!1},i.prototype.onRemovedFromScene=function(){this.world.clear(),this.world=null},i.prototype.update=function(){this.world.step(es.Time.deltaTime)},i}(es.SceneComponent);t.FSWorld=e}(physics||(physics={})),function(t){var e=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i._bodyDef=new t.FSBodyDef,i._joints=[],i}return __extends(i,e),i.prototype.update=function(){},i}(es.Component);t.FSRigidBody=e}(physics||(physics={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(es.Component);t.FSJoint=e}(physics||(physics={})),function(t){var e=function(){return function(){this.bodyType=t.BodyType.static,this.angularVelocity=0,this.linearDamping=0,this.angularDampint=0,this.isSleepingAllowed=!0,this.isAwake=!0,this.gravityScale=1,this.mass=0,this.inertia=0}}();t.FSBodyDef=e}(physics||(physics={}));